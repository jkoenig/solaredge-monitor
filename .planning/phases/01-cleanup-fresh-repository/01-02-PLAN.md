---
phase: 01-cleanup-fresh-repository
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - .git/
  - .gitignore
autonomous: false

must_haves:
  truths:
    - "git log shows no commits containing credentials (API keys, passwords, emails, VINs)"
    - "git log shows a clean initial commit with only solar-related code"
    - ".gitignore excludes .env, debug/, __pycache__/, *.pyc, .DS_Store"
    - ".planning/ directory exists and is tracked in the repository"
    - "All solar source files are tracked: se-overview.py, epd_2in13_V3_test.py, fonts/, lib/waveshare_epd/, display/"
  artifacts:
    - path: ".git/"
      provides: "Fresh git repository with no credential history"
    - path: ".gitignore"
      provides: "Properly configured ignore rules"
      contains: ".env"
  key_links:
    - from: ".gitignore"
      to: "debug/"
      via: "gitignore pattern"
      pattern: "debug/"
---

<objective>
Create a fresh git repository with no credential history, replacing the existing repository that contains hardcoded API keys, passwords, and emails in its commit history.

Purpose: The existing git history contains credentials in every commit (SolarEdge API key, VW/BMW passwords, SSH credentials). Since the codebase will be published to GitHub, a fresh repo with zero credential history is the safest and simplest approach.
Output: A new git repository with a clean initial commit containing only the solar-related codebase and planning documents.
</objective>

<execution_context>
@/Users/jean-pierrekoenig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jean-pierrekoenig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-cleanup-fresh-repository/01-01-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:decision" gate="blocking">
  <decision>Confirm destruction of existing git history and creation of fresh repository</decision>
  <context>
The existing git repository has credentials baked into every commit (SolarEdge API key, VW/BMW passwords, SSH passwords). Plan 01 has already removed all non-solar code and credentials from the working tree.

This task will:
1. Delete the existing `.git/` directory (destroying all commit history)
2. Create a new git repository with `git init`
3. Create a proper `.gitignore`
4. Make a clean initial commit

The old commit history has no significant value -- it was generated with an older AI and contains credentials that make it unsafe to publish. All planning documents in `.planning/` will be preserved and committed to the new repo.
  </context>
  <options>
    <option id="proceed">
      <name>Proceed with fresh repository</name>
      <pros>Clean history, no credential exposure risk, simple</pros>
      <cons>Lose 6 commits of history (low value)</cons>
    </option>
    <option id="abort">
      <name>Keep existing repository</name>
      <pros>Preserve history</pros>
      <cons>Credentials remain in history, requires BFG Repo Cleaner or git filter-branch</cons>
    </option>
  </options>
  <resume-signal>Select: proceed or abort</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Create fresh git repository with proper .gitignore</name>
  <files>.git/, .gitignore</files>
  <action>
**1. Create a proper .gitignore file FIRST (before destroying .git):**

Write `.gitignore` with these patterns:
```
# Environment and secrets
.env
.env.*
!.env.example

# Python
__pycache__/
*.pyc
*.pyo
*.egg-info/
*.egg

# Debug output (generated at runtime)
debug/

# OS files
.DS_Store
Thumbs.db

# IDE
.vscode/
.idea/
*.swp
*.swo
```

**2. Delete existing git repository:**
```bash
rm -rf .git
```

**3. Initialize fresh repository:**
```bash
git init
git branch -m main
```

**4. Stage all files for initial commit:**
```bash
git add .gitignore
git add se-overview.py
git add epd_2in13_V3_test.py
git add fonts/
git add lib/
git add display/
git add .planning/
git add .claude/
```

Do NOT add:
- `debug/` (runtime generated, in .gitignore)
- `.DS_Store` (in .gitignore)
- Any `.env` files

**5. Create initial commit:**
```bash
git commit -m "Initial commit: SolarEdge off-grid monitor

Clean solar-only codebase for Raspberry Pi Zero WH with
Waveshare 2.13\" e-ink display. Fetches SolarEdge API data
(power flow, energy details, site overview) and renders to
e-ink display with 4x supersampling.

Non-solar integrations (VW WeConnect, BMW ConnectedDrive,
Time Machine SSH) removed. Fresh repository created to
eliminate credential history from prior development."
```

**6. Verify the commit contains no credentials:**
```bash
git log -p | grep -iE "\[REDACTED-|paramiko|weconnect|bimmer"
# Must return nothing
```
  </action>
  <verify>
```bash
# Fresh repo exists
test -d .git && echo "PASS: .git exists" || echo "FAIL"

# Main branch
git branch --show-current
# Expected: main

# Exactly 1 commit
git rev-list --count HEAD
# Expected: 1

# .gitignore exists and is tracked
git ls-files .gitignore | grep -q .gitignore && echo "PASS" || echo "FAIL"

# Key files tracked
git ls-files se-overview.py | grep -q se-overview.py && echo "PASS: se-overview.py tracked" || echo "FAIL"
git ls-files lib/waveshare_epd/epd2in13_V3.py | grep -q epd2in13_V3.py && echo "PASS: driver tracked" || echo "FAIL"
git ls-files .planning/PROJECT.md | grep -q PROJECT.md && echo "PASS: planning tracked" || echo "FAIL"

# debug/ is NOT tracked
git ls-files debug/ | wc -l
# Expected: 0

# No credentials in history
git log -p | grep -c "\[REDACTED-"
# Expected: 0

# .gitignore contains expected patterns
grep -q ".env" .gitignore && echo "PASS: .env ignored" || echo "FAIL"
grep -q "debug/" .gitignore && echo "PASS: debug/ ignored" || echo "FAIL"
grep -q "__pycache__" .gitignore && echo "PASS: __pycache__ ignored" || echo "FAIL"
```
  </verify>
  <done>
Fresh git repository exists on `main` branch with exactly 1 commit. The commit contains only solar-related code, fonts, display images, planning docs, and waveshare driver. Zero credentials in any commit. .gitignore properly excludes .env, debug/, __pycache__/, and OS files.
  </done>
</task>

</tasks>

<verification>
Final phase verification after both plans complete:

```bash
# CLN-01: VW WeConnect removed
grep -rE "weconnect|wci|we_connect" --include="*.py" . && echo "FAIL: CLN-01" || echo "PASS: CLN-01"
test -d weconnect && echo "FAIL: CLN-01 dir" || echo "PASS: CLN-01 dir"

# CLN-02: BMW removed
grep -rE "bimmer_connected|bmw|MyBMWAccount" --include="*.py" . && echo "FAIL: CLN-02" || echo "PASS: CLN-02"

# CLN-03: Time Machine removed
grep -rE "paramiko|timemachine|time_machine|get_free_disk" --include="*.py" . && echo "FAIL: CLN-03" || echo "PASS: CLN-03"

# CLN-04: Only epd2in13_V3 driver remains
file_count=$(ls lib/waveshare_epd/ | wc -l)
[ "$file_count" -eq 5 ] && echo "PASS: CLN-04 ($file_count files)" || echo "FAIL: CLN-04 ($file_count files)"

# CLN-05: Fresh repo, no credential history
commit_count=$(git rev-list --count HEAD)
[ "$commit_count" -eq 1 ] && echo "PASS: CLN-05 (fresh repo)" || echo "FAIL: CLN-05 ($commit_count commits)"
credential_hits=$(git log -p | grep -cE "\[REDACTED-" || true)
[ "$credential_hits" -eq 0 ] && echo "PASS: CLN-05 (no credentials)" || echo "FAIL: CLN-05 ($credential_hits credential hits)"
```
</verification>

<success_criteria>
1. Fresh git repository with exactly 1 commit on `main` branch
2. Zero credentials in any commit (verified by searching full git log)
3. .gitignore excludes .env, debug/, __pycache__/, .DS_Store
4. All solar source files, fonts, display images, and .planning/ are tracked
5. debug/ directory is NOT tracked (runtime generated)
</success_criteria>

<output>
After completion, create `.planning/phases/01-cleanup-fresh-repository/01-02-SUMMARY.md`
</output>
