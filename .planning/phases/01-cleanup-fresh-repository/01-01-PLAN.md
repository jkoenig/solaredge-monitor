---
phase: 01-cleanup-fresh-repository
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - se-overview.py
  - weconnect/
  - se-monitor2.py
  - se-monitor.old.py
  - lib/waveshare_epd/
  - display/
  - debug/
autonomous: true

must_haves:
  truths:
    - "se-overview.py contains zero references to VW, WeConnect, BMW, bimmer_connected, paramiko, or Time Machine"
    - "se-overview.py contains zero hardcoded credentials (no API keys, passwords, emails, VINs)"
    - "Only solar-related functions remain: get_site_overview, get_energy_details, get_current_power_flow, display, display2, display3"
    - "Main loop calls only solar display functions (display, display2, display3)"
    - "Only epd2in13_V3.py, epdconfig.py, __init__.py, and .so binaries remain in lib/waveshare_epd/"
    - "weconnect/ directory does not exist"
    - "se-monitor2.py and se-monitor.old.py do not exist"
  artifacts:
    - path: "se-overview.py"
      provides: "Cleaned solar-only monitor script"
      contains: "get_site_overview"
    - path: "lib/waveshare_epd/epd2in13_V3.py"
      provides: "Primary display driver"
    - path: "lib/waveshare_epd/epdconfig.py"
      provides: "Display configuration module"
    - path: "lib/waveshare_epd/__init__.py"
      provides: "Package init"
  key_links:
    - from: "se-overview.py"
      to: "lib/waveshare_epd/epd2in13_V3.py"
      via: "from waveshare_epd import epd2in13_V3"
      pattern: "from waveshare_epd import epd2in13_V3"
---

<objective>
Remove all non-solar integrations (VW WeConnect, BMW ConnectedDrive, Time Machine SSH), delete duplicate/legacy files, and strip unused Waveshare display drivers.

Purpose: Clean the codebase down to solar-only functionality before creating a fresh git repository without credential history.
Output: A single clean `se-overview.py` with only SolarEdge API and solar display functions, and a minimal Waveshare driver directory.
</objective>

<execution_context>
@/Users/jean-pierrekoenig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jean-pierrekoenig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@se-overview.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Strip non-solar code from se-overview.py and delete non-solar files</name>
  <files>se-overview.py, weconnect/, se-monitor2.py, se-monitor.old.py, display/</files>
  <action>
Edit se-overview.py to remove all non-solar integrations. The file currently has 829 lines. Here is exactly what to change:

**1. Remove non-solar imports (lines 10, 16-18, 27-28):**
- Remove: `import paramiko`
- Remove: `from weconnect import wci`
- Remove: `from urllib.parse import urlencode`
- Remove: `import asyncio`
- Remove: `from bimmer_connected.account import MyBMWAccount`
- Remove: `from bimmer_connected.api.regions import Regions`

Keep these imports:
```python
import logging
import requests
import datetime
import sys
import os
import time
import traceback
import datetime as dt
from PIL import Image, ImageDraw, ImageFont
```

**2. Remove all hardcoded credentials (lines 32-46):**
- Remove: `api_key = "[REDACTED-API-KEY]"`
- Remove: `site_id = "[REDACTED-SITE-ID]"`
- Remove: `hostname = "timemachine.local"`
- Remove: `username = "pi"`
- Remove: `password = "[REDACTED-PASSWORD]"`
- Remove: `we_connect_email_address = ...`
- Remove: `we_connect_password = ...`
- Remove: `we_connect_vin = ...`
- Remove: `bmw_email_address = ...`
- Remove: `bmw_password = ...`
- Remove: `bmw_vin = ...`
- Remove: `mount_point = "/mnt/backups"`

Replace with placeholder comments for Phase 2 (env var extraction):
```python
# TODO: Phase 2 will extract these to environment variables
api_key = "YOUR_API_KEY"
site_id = "YOUR_SITE_ID"
```

**3. Remove the `to_camel_case()` utility function (lines 69-72):**
- This function is only used by `get_bmw_state_of_charge()`. Remove it entirely.

**4. Remove `get_free_disk_space_of_timemachine()` function (lines 256-285):**
- Remove the entire function definition (30 lines).

**5. Remove `get_vw_state_of_charge()` function (lines 287-330):**
- Remove the entire function definition (44 lines).

**6. Remove `get_bmw_state_of_charge()` function (lines 332-371):**
- Remove the entire function definition (40 lines).

**7. Remove `display4()` function (lines 602-661):**
- This is the Time Machine disk usage display. Remove entirely.

**8. Remove `display5()` function (lines 663-731):**
- This is the VW Gisela charging display. Remove entirely.

**9. Remove `display6()` function (lines 733-808):**
- This is the BMW i3s charging display. Remove entirely.

**10. Update the main loop (lines 810-829):**
Replace the functions list to only include solar displays:
```python
if __name__ == "__main__":
    logging.info("SolarEdge Monitor started ...")

    functions = [
        lambda: display3(get_current_power_flow()),
        lambda: display2(get_current_power_flow()),
        lambda: display(get_energy_details()),
    ]

    while True:
            current_hour = dt.datetime.now().hour
            if 6 <= current_hour < 24:
                for func in functions:
                    func()
                    time.sleep(sleep_timer)
            else:
                time.sleep(sleep_timer)
```

**11. Delete non-solar files and directories:**
```bash
rm -rf weconnect/
rm -f se-monitor2.py
rm -f se-monitor.old.py
```

**12. Clean display directory of non-solar screenshots:**
```bash
rm -f display/2-13inch-EInk-timemachine-disk-usage.png
rm -f display/2-13inch-EInk-weconnect-vehicle-charging.png
rm -f display/2-13inch-EInk-bmw-i3s-charging.png
```

**13. Clean debug directory of non-solar logs:**
```bash
rm -f debug/weconnect-vehicle-charging-results.txt
```
  </action>
  <verify>
Run these checks:
```bash
# No non-solar imports
grep -c "paramiko\|weconnect\|bimmer_connected\|asyncio\|urlencode" se-overview.py
# Should return 0

# No real credentials remain
grep -c "[REDACTED-API-KEY]\|[REDACTED-EMAIL]\|[REDACTED-PASSWORD]\|[REDACTED-VIN]" se-overview.py
# Should return 0

# Non-solar functions removed
grep -c "get_free_disk_space\|get_vw_state\|get_bmw_state\|display4\|display5\|display6\|to_camel_case" se-overview.py
# Should return 0

# Non-solar files removed
ls weconnect/ 2>/dev/null && echo "FAIL: weconnect still exists" || echo "OK"
ls se-monitor2.py 2>/dev/null && echo "FAIL: se-monitor2.py still exists" || echo "OK"
ls se-monitor.old.py 2>/dev/null && echo "FAIL: se-monitor.old.py still exists" || echo "OK"

# Solar functions still present
grep -c "get_site_overview\|get_energy_details\|get_current_power_flow" se-overview.py
# Should return 3+ (function defs + calls)

# Non-solar display images removed
ls display/2-13inch-EInk-timemachine-disk-usage.png 2>/dev/null && echo "FAIL" || echo "OK"
ls display/2-13inch-EInk-bmw-i3s-charging.png 2>/dev/null && echo "FAIL" || echo "OK"
ls display/2-13inch-EInk-weconnect-vehicle-charging.png 2>/dev/null && echo "FAIL" || echo "OK"
```
  </verify>
  <done>
se-overview.py contains ONLY solar code: 3 SolarEdge API functions, 3 solar display functions, and a solar-only main loop. All VW, BMW, Time Machine code and credentials are gone. Duplicate files (se-monitor2.py, se-monitor.old.py) deleted. weconnect/ directory deleted. Non-solar display images and debug logs removed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove unused Waveshare display drivers</name>
  <files>lib/waveshare_epd/</files>
  <action>
Remove all Waveshare e-ink display drivers EXCEPT the files needed for the 2.13" V3 display.

**Keep these files (5 total):**
- `epd2in13_V3.py` — the active display driver
- `epdconfig.py` — shared configuration module (imported by epd2in13_V3.py)
- `__init__.py` — package init file
- `DEV_Config_32.so` — 32-bit hardware abstraction binary
- `DEV_Config_64.so` — 64-bit hardware abstraction binary

**Delete everything else** — approximately 60+ unused driver files. Delete using a targeted approach:

```bash
cd lib/waveshare_epd/

# Remove all epd*.py EXCEPT epd2in13_V3.py and epdconfig.py
for f in epd*.py; do
  if [ "$f" != "epd2in13_V3.py" ] && [ "$f" != "epdconfig.py" ]; then
    rm "$f"
  fi
done

# Remove __pycache__ directory
rm -rf __pycache__

# Remove .pyc files
rm -f *.pyc

# Remove extra .so files (keep only DEV_Config_32.so and DEV_Config_64.so)
rm -f sysfs_gpio.so sysfs_software_spi.so
```
  </action>
  <verify>
```bash
# List remaining files — should be exactly 5
ls lib/waveshare_epd/
# Expected: DEV_Config_32.so DEV_Config_64.so __init__.py epd2in13_V3.py epdconfig.py

# Count files — should be 5
ls lib/waveshare_epd/ | wc -l
# Expected: 5

# Verify key driver exists
test -f lib/waveshare_epd/epd2in13_V3.py && echo "OK: driver exists" || echo "FAIL"
test -f lib/waveshare_epd/epdconfig.py && echo "OK: config exists" || echo "FAIL"
test -f lib/waveshare_epd/__init__.py && echo "OK: init exists" || echo "FAIL"
```
  </verify>
  <done>
lib/waveshare_epd/ contains exactly 5 files: epd2in13_V3.py, epdconfig.py, __init__.py, DEV_Config_32.so, DEV_Config_64.so. All 60+ unused display drivers removed.
  </done>
</task>

</tasks>

<verification>
After both tasks complete, verify the full cleanup:

```bash
# 1. No non-solar code in se-overview.py
grep -E "paramiko|weconnect|bimmer_connected|bmw|vw_state|timemachine|time_machine|display4|display5|display6" se-overview.py && echo "FAIL: non-solar code remains" || echo "PASS"

# 2. No real credentials anywhere in codebase
grep -rE "\[REDACTED-" --include="*.py" . && echo "FAIL: credentials remain" || echo "PASS"

# 3. weconnect directory gone
test -d weconnect && echo "FAIL" || echo "PASS: weconnect removed"

# 4. Duplicate files gone
test -f se-monitor2.py && echo "FAIL" || echo "PASS: se-monitor2.py removed"
test -f se-monitor.old.py && echo "FAIL" || echo "PASS: se-monitor.old.py removed"

# 5. Only 5 files in waveshare_epd
file_count=$(ls lib/waveshare_epd/ | wc -l)
[ "$file_count" -eq 5 ] && echo "PASS: $file_count waveshare files" || echo "FAIL: $file_count waveshare files (expected 5)"

# 6. Solar functions still work (syntax check)
python3 -c "import ast; ast.parse(open('se-overview.py').read()); print('PASS: syntax valid')"

# 7. .planning directory preserved
test -d .planning && echo "PASS: .planning preserved" || echo "FAIL: .planning missing"
```
</verification>

<success_criteria>
1. se-overview.py is syntactically valid Python containing only SolarEdge solar monitoring code
2. Zero non-solar imports (no paramiko, weconnect, bimmer_connected, asyncio, urlencode)
3. Zero hardcoded real credentials in any Python file
4. Zero non-solar functions (no VW, BMW, Time Machine, display4/5/6)
5. weconnect/ directory deleted, se-monitor2.py deleted, se-monitor.old.py deleted
6. lib/waveshare_epd/ contains exactly 5 files
7. .planning/ directory fully preserved
</success_criteria>

<output>
After completion, create `.planning/phases/01-cleanup-fresh-repository/01-01-SUMMARY.md`
</output>
